<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Browse - Matrimony Nepal</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="/js/app.js"></script>
</head>

<body>
    <nav id="main-nav"></nav>

    <div class="container">
        <div class="flex flex-col md:flex-row justify-between items-center mb-8 gap-6 animate-fade-up">
            <div class="text-center md:text-left">
                <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Explore Profiles</h1>
                <p style="margin: 0; font-size: 1.1rem;">Connect with people who share your values.</p>
            </div>

            <input id="search-input" class="input-field" placeholder="Search by name, location, qualities..."
                style="max-width: 400px; padding: 1.2rem; font-size: 1.1rem;">
        </div>

        <div id="users-container" class="grid animate-fade-up animate-delay-1">
            <!-- Cards go here -->
        </div>
    </div>

    <script>
        let allUsers = [];
        let currentUser = null;

        document.addEventListener('DOMContentLoaded', async () => {
            currentUser = App.auth.getUser();
            try {
                const users = await App.api.get('/api/users');
                allUsers = currentUser ? users.filter(u => u.id !== currentUser.id) : users;
                renderUsers(allUsers);
            } catch (e) { }

            document.getElementById('search-input').addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                renderUsers(allUsers.filter(u =>
                    u.name.toLowerCase().includes(term) ||
                    (u.location && u.location.toLowerCase().includes(term)) ||
                    (u.qualities && u.qualities.some(q => q.toLowerCase().includes(term)))
                ));
            });
        });

        function renderUsers(users) {
            const container = document.getElementById('users-container');
            container.innerHTML = '';

            if (users.length === 0) {
                container.innerHTML = '<div class="text-center w-full" style="grid-column: 1/-1; padding: 4rem; color: var(--text-muted); font-size: 1.1rem;">No profiles found matching criteria.</div>';
                return;
            }

            users.forEach((u, idx) => {
                const card = document.createElement('div');
                card.className = 'card animate-fade-up';
                card.style.animationDelay = `${idx * 0.1}s`;
                card.style.display = 'flex';
                card.style.flexDirection = 'column';
                card.style.gap = '1.5rem';

                const initials = u.name.charAt(0);

                let imgHtml = u.photo
                    ? `<img src="${u.photo}" style="width: 72px; height: 72px; border-radius: 20px; object-fit: cover;">`
                    : `<div style="width: 72px; height: 72px; border-radius: 20px; background: var(--bg-subtle); color: var(--text-main); display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.5rem;">${initials}</div>`;

                const qualitiesHtml = (u.qualities || []).slice(0, 3).map(q =>
                    `<span style="background: var(--bg-subtle); color: var(--text-muted); padding: 4px 12px; border-radius: 99px; font-size: 0.85rem; font-weight: 600;">${q}</span>`
                ).join(' ');

                card.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 1.25rem;">
                        ${imgHtml}
                        <div>
                            <h3 style="font-size: 1.25rem; margin-bottom: 0.2rem; color: var(--text-main);">${u.name}</h3>
                            <p style="font-size: 0.95rem; margin: 0; color: var(--primary); font-weight: 500;">${u.location || 'Unknown'}</p>
                        </div>
                    </div>
                    
                    <div style="flex-grow: 1;">
                        <p style="font-size: 1rem; line-height: 1.6; color: var(--text-muted);">"${u.about || 'No bio provided.'}"</p>
                    </div>

                    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">${qualitiesHtml}</div>

                    <button onclick="alert('Request sent to ${u.name}!')" class="btn-primary w-full" style="margin-top: 0.5rem; padding: 1rem;"><span>Reach Out</span></button>
                `;
                container.appendChild(card);
            });
        }
    </script>
</body>

</html>